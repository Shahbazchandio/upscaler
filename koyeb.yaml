name: flask-image-processor
services:
  - name: web
    instance_type: free
    env: python
    buildCommand: |
      pip install -r requirements.txt
      flask db upgrade
      mkdir -p /app/models
      wget -O /app/models/ESRGAN_x4.pth https://github.com/xinntao/Real-ESRGAN/releases/download/v0.1.0/RealESRGAN_x4plus.pth
      wget -O /app/models/GFPGANv1.3.pth https://github.com/TencentARC/GFPGAN/releases/download/v1.3.0/GFPGANv1.3.pth
    runCommand: gunicorn run:app
    ports:
      - port: 8000
    envs:
      - key: SECRET_KEY
        value: "your-secret-key"
      - key: DATABASE_URL
        value: "sqlite:///app.db"